<style>
  body {
    margin: 0px;
  }
</style>

<body>
  <div id="world"></div>
  <div id="ui">
    <div id="tiles"></div>
    <div id="froggies"></div>
    <div id="rides"></div>
    <div id="cars"></div>
  </div>
</body>

<script type="module">
  import { Canvas } from './src/common/Canvas.js';
  import { Tiles } from './src/Tiles.js';
  import { Rides } from './src/Rides.js';
  import { Cars } from './src/Cars.js';
  import { Froggy } from './src/Froggy.js';
  import { World } from './src/World.js';
  
  const TILE_SIZE = 64;

  World.DebugGrid = true;
  
  const world = await World.fromFile( './levels/test1.json' );
  const worldCanvas = new Canvas( world.cols * TILE_SIZE, world.rows * TILE_SIZE );
  
  redraw();
  
  const worldDiv = document.getElementById( 'world' );
  worldDiv.appendChild( worldCanvas.canvas );

  const tilesDiv = document.getElementById( 'tiles' );
  tilesDiv.appendChild( document.createTextNode( 'Tiles: ' ) );
  for ( const tile in Tiles ) {
    const button = document.createElement( 'button' );
    button.textContent = tile;
    tilesDiv.appendChild( button );
  }

  const froggiesDiv = document.getElementById( 'froggies' );
  froggiesDiv.appendChild( document.createTextNode( 'Froggies: ' ) );
  for ( let i = 0; i < Froggy.Count; i ++ ) {
    const button = document.createElement( 'button' );
    button.textContent = Froggy.Colors[ i ];  // i
    froggiesDiv.appendChild( button );
  }

  const ridesDiv = document.getElementById( 'rides' );
  ridesDiv.appendChild( document.createTextNode( 'Rides: ' ) );
  for ( const ride in Rides ) {
    const button = document.createElement( 'button' );
    button.textContent = ride;
    ridesDiv.appendChild( button );
  }

  const carsDiv = document.getElementById( 'cars' );
  carsDiv.appendChild( document.createTextNode( 'Cars: ' ) );
  for ( const car in Cars ) {
    const button = document.createElement( 'button' );
    button.textContent = car;
    carsDiv.appendChild( button );
  }

  document.addEventListener( 'mousedown', ( e ) => {
    const col = Math.floor( e.clientX / TILE_SIZE );
    const row = Math.floor( e.clientY / TILE_SIZE );

    world.tiles[ col ][ row ].tileInfo = Tiles.Grass;
    redraw();
  } );

  function redraw() {
    const ctx = worldCanvas.ctx;

    ctx.save();

    ctx.scale( TILE_SIZE, TILE_SIZE );
    world.draw( ctx );

    ctx.beginPath();
    ctx.moveTo( world.crop.minCol,     world.crop.minRow     );
    ctx.lineTo( world.crop.minCol,     world.crop.maxRow + 1 );
    ctx.lineTo( world.crop.maxCol + 1, world.crop.maxRow + 1 );
    ctx.lineTo( world.crop.maxCol + 1, world.crop.minRow     );
    ctx.lineTo( world.crop.minCol,     world.crop.minRow     );

    ctx.setLineDash( [ 0.1, 0.1 ] );
    ctx.lineWidth = 0.05;
    ctx.stroke();

    ctx.lineTo( 0, 0 );
    ctx.lineTo( world.cols, 0 );
    ctx.lineTo( world.cols, world.rows );
    ctx.lineTo( 0, world.rows );
    ctx.lineTo( 0, 0 );

    ctx.fillStyle = "#000b";
    ctx.fill();

    ctx.restore();
  }

</script>
