<title>Frogger</title>
<link rel="stylesheet" href="./grid.css">

<style>
  body { 
    display: flex;
    flex-direction: column;
  }
</style>

<script type="module">
  import { Direction } from './src/Entity.js';
  import { World } from './src/World.js';
  
  import { AnimatedCanvas } from './src/common/AnimatedCanvas.js';

  const TILE_SIZE = 64;

  const world = await World.fromFile( './levels/test1.json' );

  const canvas = new AnimatedCanvas(
    ( world.crop.maxCol - world.crop.minCol + 1 ) * TILE_SIZE,
    ( world.crop.maxRow - world.crop.minRow + 1 ) * TILE_SIZE,
  );

  const rescuedCanvas = new AnimatedCanvas(
    14 * TILE_SIZE,
    TILE_SIZE,
  );

  canvas.update = ( dt ) => {
    world.update( dt );
  }
  
  canvas.draw = ( ctx ) => {
    ctx.save();
    ctx.scale( TILE_SIZE, TILE_SIZE );

    ctx.translate( -world.crop.minCol, -world.crop.minRow );

    world.draw( ctx );

    ctx.restore();

    rescuedCanvas.redraw();
  };

  canvas.start();

  rescuedCanvas.draw = ( ctx ) => {
    ctx.save();
    ctx.scale( TILE_SIZE, TILE_SIZE );

    world.drawUI( ctx );

    ctx.restore();
  }

  const moveUp =    () => move( Direction.Up );
  const moveDown =  () => move( Direction.Down );
  const moveLeft =  () => move( Direction.Left );
  const moveRight = () => move( Direction.Right );

  function move( dir ) {
    if ( world.needsRespawn ) {
      world.respawnPlayer();
    }
    else {
      world.player.move( dir );
    }
  }

  const KeyBindings = {
    KeyW: moveUp,
    KeyA: moveLeft,
    KeyS: moveDown,
    KeyD: moveRight,
    ArrowUp: moveUp,
    ArrowLeft: moveLeft,
    ArrowDown: moveDown,
    ArrowRight: moveRight,
    KeyG: () => World.DebugGrid = !World.DebugGrid,
  };

  document.addEventListener( 'keydown', e => KeyBindings[ e.code ]?.() );

</script>